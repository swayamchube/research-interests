\RequirePackage{
    amsmath, 
    amsthm, 
    amssymb, 
    amsfonts,
    xcolor, 
    geometry, 
    tikz, 
    hyperref, 
    mathrsfs,
    enumitem,
    fancyhdr,
    lipsum,
    nicefrac,
    wasysym,
    mathtools,
    xspace,
    anyfontsize,
    todonotes,
    fancyhdr,
    lastpage,
    stmaryrd,
    commath,
    float       % because vanilla LaTeX loses its mind trying to place my floats
    % titlesec
}
\RequirePackage{theoremref} % For referencing theorems
\RequirePackage[framemethod = tikz]{mdframed}
\usetikzlibrary{automata, arrows.meta, positioning, cd} % good ol' Theoretical CS 
\RequirePackage[all,cmtip]{xy} % For diagrams, praise the Freydâ€“Mitchell theorem 

% Input and Fonts
\RequirePackage[utf8]{inputenc}
\newcommand\hmmax{0}
\newcommand\bmmax{0}
\RequirePackage[T1]{fontenc}
\RequirePackage{mathpazo}
\RequirePackage{bm}
\SetSymbolFont{stmry}{bold}{U}{stmry}{m}{n}
\SetSymbolFont{wasy}{bold}{U}{wasy}{m}{n}
% \RequirePackage{euler}


\hypersetup {
    colorlinks=true, % because why not?
}

\geometry{
    margin=1in, % uniformity 
}

\newtheoremstyle{thmstyle}%               % Name
  {}%                                     % Space above
  {}%                                     % Space below
  {\itshape}%                             % Body font
  {}%                                     % Indent amount
  {\bfseries}%                            % Theorem head font
  {.}%                                    % Punctuation after theorem head
  { }%                                    % Space after theorem head, ' ', or \newline
  {\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}%                                     % Theorem head spec (can be left empty, meaning `normal')

\newtheoremstyle{defstyle}%               % Name
  {}%                                     % Space above
  {}%                                     % Space below
  {}%                                     % Body font
  {}%                                     % Indent amount
  {\bfseries}%                            % Theorem head font
  {.}%                                    % Punctuation after theorem head
  { }%                                    % Space after theorem head, ' ', or \newline
  {\thmname{#1}\thmnumber{ #2}\thmnote{ (#3)}}%                 


\theoremstyle{thmstyle}
\newtheorem{thm}{Theorem}[chapter]
\newtheorem{lem}[thm]{Lemma}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{remark}{Remark}[section]

\theoremstyle{defstyle}
\newtheorem{defn}[thm]{Definition}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{ex}[thm]{Example}

\newcounter{theorem}[chapter]

\newenvironment{theorem}[1][]{
	\stepcounter{theorem}
	\ifstrempty{#1}{
		\begin{mdframed}[linewidth=1pt,linecolor=blue!10, backgroundcolor=blue!10,]
		% \bfseries Theorem~\thechapter.\thetheorem.\normalfont
        \begin{thm}
    }{
		\begin{mdframed}[linewidth=1pt,linecolor=blue!10, backgroundcolor=blue!10,]
		% \bfseries Theorem~\thechapter.\thetheorem~(#1).\normalfont
        \begin{thm}[#1]
	}
}{\end{thm}\end{mdframed}}
    
\newenvironment{definition}[1][]{
    \stepcounter{theorem}
    \ifstrempty{#1}{
        \begin{mdframed}[linewidth=1pt, linecolor=gray!15, backgroundcolor=gray!15,]
        % \bfseries Definition~\thechapter.\thetheorem.\normalfont
        \begin{defn}
    }{
        \begin{mdframed}[linewidth=1pt, linecolor=gray!15, backgroundcolor=gray!15,]
        % \bfseries Definition~\thechapter.\thetheorem~(#1).\normalfont
        \begin{defn}[#1]
    }
}{\end{defn}\end{mdframed}}
                        
\newenvironment{proposition}[1][]{
    \stepcounter{theorem}
	\ifstrempty{#1}{
		\begin{mdframed}[linewidth=1pt, linecolor=blue!10, backgroundcolor=blue!10,]
		% \bfseries Proposition~\thechapter.\thetheorem.\normalfont
        \begin{prop}
	}{
		\begin{mdframed}[linewidth=1pt, linecolor=blue!10, backgroundcolor=blue!10,]
		% \bfseries Proposition~\thechapter.\thetheorem~(#1).\normalfont
        \begin{prop}[#1]
	}
}{\end{prop}\end{mdframed}}

\newenvironment{corollary}[1][]{
	\ifstrempty{#1}{
		\begin{mdframed}[linewidth=1pt, linecolor=blue!10, backgroundcolor=blue!10,]
        \begin{cor}
	}{
		\begin{mdframed}[linewidth=1pt, linecolor=blue!10, backgroundcolor=blue!10,]
        \begin{cor}[#1]
	}
}{\end{cor}\end{mdframed}}
    
\newenvironment{lemma}[1][]{
	\stepcounter{theorem}
	\ifstrempty{#1}{
		\begin{mdframed}[linewidth=0pt, linecolor=yellow, backgroundcolor=yellow!30,]
		% \bfseries Lemma~\thechapter.\thetheorem.\normalfont
        \begin{lem}
	}{
		\begin{mdframed}[linewidth=0pt, linecolor=yellow, backgroundcolor=yellow!30,]
        % \bfseries Lemma~\thechapter.\thetheorem~(#1).\normalfont
        \begin{lem}[#1]
	}
}{\end{lem}\end{mdframed}}

\newenvironment{example}[1][]{
    \ifstrempty{#1}{
		\begin{mdframed}[linewidth=1pt, linecolor=red!20, backgroundcolor=red!20,]
		% \bfseries Example.\normalfont
        \begin{ex}
	}{
		\begin{mdframed}[linewidth=1pt, linecolor=red!20, backgroundcolor=red!20,]
		% \bfseries Example~(#1).\normalfont
        \begin{ex}[#1]
	}
}{\end{ex}\end{mdframed}}

\newenvironment{exercise}{
	\begin{mdframed}[linewidth=1pt, linecolor=green, backgroundcolor=green!10,]
    \bfseries Exercise.\normalfont
}{\end{mdframed}}


\renewcommand{\qedsymbol}{$\blacksquare$}
\renewcommand{\emptyset}{\varnothing}
\renewcommand{\footrulewidth}{\headrulewidth}
\setlength{\headheight}{15pt}

% Common Algebraic Structures
\newcommand{\R}{\mathbb{R}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\bbC}{\mathbb{C}}
\newcommand{\calA}{\mathcal{A}}
\newcommand{\frakM}{\mathfrak{M}}

% Categories
\newcommand{\catTopp}{\mathbf{Top}_*}
\newcommand{\catGrp}{\mathbf{Grp}}
\newcommand{\catTopGrp}{\mathbf{TopGrp}}
\newcommand{\catSet}{\mathbf{Set}}
\newcommand{\catTop}{\mathbf{Top}}
\newcommand{\catRing}{\mathbf{Ring}}
\newcommand{\catCRing}{\mathbf{CRing}} % comm. rings
\newcommand{\catMod}{\mathbf{Mod}}
\newcommand{\catMon}{\mathbf{Mon}}
\newcommand{\catMan}{\mathbf{Man}} % manifolds
\newcommand{\catDiff}{\mathbf{Diff}} % smooth manifolds
\newcommand{\catAlg}{\mathbf{Alg}}
\newcommand{\catRep}{\mathbf{Rep}} % representations 
\newcommand{\catVec}{\mathbf{Vec}}

% Group and Representation Theory
\newcommand{\chr}{\operatorname{char}}
\newcommand{\Aut}{\operatorname{Aut}}
\newcommand{\GL}{\operatorname{GL}}
\newcommand{\im}{\operatorname{im}}
\newcommand{\tr}{\operatorname{tr}}
\newcommand{\id}{\mathbf{id}}
\newcommand{\cl}{\mathbf{cl}}
\newcommand{\Gal}{\operatorname{Gal}}
\newcommand{\Tr}{\operatorname{Tr}}
\newcommand{\sgn}{\operatorname{sgn}}
\newcommand{\Sym}{\operatorname{Sym}}
\newcommand{\Alt}{\operatorname{Alt}}

% Commutative and Homological Algebra
\newcommand{\spec}{\operatorname{spec}}
\newcommand{\mspec}{\operatorname{m-spec}}
\newcommand{\Tor}{\operatorname{Tor}}
\newcommand{\tor}{\operatorname{tor}}
\newcommand{\Ann}{\operatorname{Ann}}
\newcommand{\Supp}{\operatorname{Supp}}
\newcommand{\Hom}{\operatorname{Hom}}
\newcommand{\End}{\operatorname{End}}
\newcommand{\coker}{\operatorname{coker}}
\newcommand{\limit}{\varprojlim}
\newcommand{\colimit}{%
  \mathop{\mathpalette\colimit@{\rightarrowfill@\textstyle}}\nmlimits@
}
\makeatother


\newcommand{\fraka}{\mathfrak a} % ideal
\newcommand{\frakb}{\mathfrak b} % ideal
\newcommand{\frakc}{\mathfrak c} % ideal
\newcommand{\frakm}{\mathfrak m} % maximal ideal
\newcommand{\frakp}{\mathfrak p} % prime ideal
\newcommand{\frakq}{\mathfrak q} % qrime ideal
\newcommand{\frakN}{\mathfrak N} % nilradical 
\newcommand{\frakR}{\mathfrak R} % jacobson radical

% General/Differential/Algebraic Topology 
\newcommand{\scrA}{\mathscr A}
\newcommand{\scrB}{\mathscr B}
\newcommand{\scrP}{\mathscr P}
\newcommand{\scrS}{\mathscr S}
\newcommand{\bbH}{\mathbb H}
\newcommand{\Int}{\operatorname{Int}}

% Miscellaneous
\newcommand{\psimeq}{\simeq_p}
\newcommand{\wt}[1]{\widetilde{#1}}
\newcommand{\wh}[1]{\widehat{#1}}
\newcommand{\calM}{\mathcal{M}}
\newcommand{\onto}{\twoheadrightarrow}
\newcommand{\into}{\hookrightarrow}
\newcommand{\Gr}{\operatorname{Gr}}
\newcommand{\Span}{\operatorname{Span}}