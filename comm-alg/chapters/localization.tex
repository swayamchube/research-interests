\section{Rings of Fractions}

Define the relation $\sim_S$ on $A\times S$ by $(a,s)\sim_S(a',s')$ if there is $t\in S$ such that $t(s'a - sa') = 0$. That this is an equivalence relation is easy to verify. We shall use $a/s$ to denote the equivalence class $[(a,s)]$ in $A\times S/\sim_S$.

Consider the operations: 
\begin{equation*}
    \frac{a}{s} + \frac{a'}{s'} = \frac{s'a + sa'}{ss'}\qquad\frac{a}{s}\cdot\frac{a'}{s'} = \frac{aa'}{ss'}
\end{equation*}

It is not hard to see that these are well defined and endow $A\times S/\sim_S$ with a ring structure. We denote this ring by $S^{-1}A$ and is called the \textit{ring of fractions} of $A$ by $S$. 

There is a natural ring homomorphism $\varphi: A\to S^{-1}A$ given by $\varphi(x) = x/1$.
When $A$ is an integral domain and $S = A\backslash\{0\}$, $S^{-1}A$ is precisely the field of fractions.
Recall that if $\mathfrak p$ is a prime ideal in $A$, then $S = A\backslash\mathfrak p$ is a multiplicatively closed subset of $A$. We denote the ring $S^{-1}A$ by $A_{\mathfrak p}$.

\begin{theorem}
    The ring $A_{\mathfrak p}$ is local.
\end{theorem}
\begin{proof}
    Let $S = A\backslash\mathfrak p$ and define
    \begin{equation*}
        \mathfrak m = \left\{\frac{a}{s}~\bigg\vert~a\in\mathfrak p,~s\in S\right\}
    \end{equation*}
    It is not hard to see that $\mathfrak m$ is an ideal in $A_{\mathfrak p}$. We contend that $\mathfrak m$ is the ideal of non-units in $A_{\mathfrak p}$. Indeed, if $a/s\in\mathfrak m$ is a unit, then there is $b/t\in A_{\mathfrak p}$ such that $(ab)/(st) = 1$, consequently, there is $w\in S$ such that $w(ab - st) = 0$, whence $wst\in\mathfrak p$, a contradiction. 

    On the other hand, if $a/s\notin\mathfrak m$, then $a/s$ is a unit since $(a/s)\cdot(s/a) = 1$. Now, since the collection of all non-units forms an ideal, the ring must be local due to \thref{prop:non-unit-ideal-local}.
\end{proof}

\begin{proposition}
    Let $\mathfrak m$ be the unique maximal ideal of $A_{\mathfrak p}$. Then, $A_{\mathfrak p}/\mathfrak m\cong Q(A/\mathfrak p)$ where the latter is the field of fractions of $A/\mathfrak p$.
\end{proposition}
\begin{proof}
    \textcolor{red}{TODO: Add in later}
\end{proof}

Similarly, when we let $S = \{a^n\}_{n\ge 0}$ for some $a\in A$, we denote $S^{-1}A$ by $A_a$.

There is a degenerate case, when we allow $0\in S$, notice that the ring $S^{-1}A$ is the zero ring, since for all $a/s\in S^{-1}A$, we have $0(as) = 0$, therefore, $a/s = 0/s$.

\begin{proposition}\thlabel{prop:localization-of-product}
    Let $\{A_i\}_{i\in I}$ be a collection of commutative rings and $\{S_i\subseteq A_i\}$ be a collection of multiplicatively closed sets. Then, 
    \begin{equation*}
        \left(\prod_{i\in I}S_i\right)^{-1}\left(\prod_{i\in I}A_i\right)\cong\prod_{i\in I}(S_i^{-1}A_i)
    \end{equation*}
\end{proposition}
\begin{proof}
    Define the map $\phi: \prod_{i\in I}(S_i^{-1}A_i)\to\left(\prod_{i\in I}S_i\right)^{-1}\left(\prod_{i\in I}A_i\right)$ given by 
    \begin{equation*}
        \phi\left(\left(\frac{a_i}{s_i}\right)_{i\in I}\right) = \frac{(a_i)_{i\in I}}{(s_i)_{i\in I}}
    \end{equation*}
    It is straightforward to argue that this map is well defined and surjective. We now contend that this is an isomorphism, for which it suffices to show that $\ker\phi$ is trivial. Indeed, if $(a_i/s_i)_{i\in I}\in\ker\phi$, then there is $(t_i)_{i\in I}$ such that $(t_ia_i)_{i\in I} = (0)_{i\in I}$ whereby, $t_ia_i = 0$ for each $i$ and $a_i/s_i = 0$. This completes the proof.
\end{proof}

\begin{corollary}
    Let $\{A_i\}$ be a collection of rings then every localization of $\prod_{i\in I}A_i$ is of the form $(A_i)_{\frakp_i}$ for some $i\in I$ where $\frakp_i\subseteq A_i$ is a prime ideal.
\end{corollary}
\begin{proof}
    Follows from the fact that prime ideals in $\prod_{i\in I}A_i$ are of the form $\pi_i^{-1}(\frakp_i)$ where $\frakp_i$ is a prime ideal in $A_i$ and $\pi: \prod_{i\in I}A_i\to A_i$ is the natural projection map.
\end{proof}

\subsection{Universal Property}

Fix a multiplicative subset $S\subseteq A$. Let $\mathscr C$ denote the category with objects as pairs $(\phi, B)$ where $\phi: A\to B$ is a ring homomorphism such that $\phi(s)$ is a unit in $B$ for all $s\in S$. A morphism in this category is a map $f:(\phi, B)\to(\psi, C)$ making the following diagram commute.
\begin{equation*}
\xymatrix{
    A\ar[r]^{\psi}\ar[d]_\phi & C\\
    B\ar[ru]_f
}
\end{equation*}

The ring of fractions is an initial object in this category. Therefore, we have the following universal property. We shall verify in the ``proof'' that our construction of the field of fractions does satisfy this property and is therefore an initial object in $\mathscr C$.

\begin{proposition}
    Let $f: A\to B$ be a ring homomorphism such that $f(s)$ is a unit in $B$ for all $s\in S$. Then there is a unique ring homomorphism $g: S^{-1}A\to B$ making the following diagram commute 
    \begin{equation*}
    \xymatrix{
        A\ar[r]^f\ar[d]_\varphi & B\\
        S^{-1}A\ar@{.>}[ru]_-{\exists!g}
    }
    \end{equation*}
\end{proposition}
\begin{proof}
    Define the map $g: S^{-1}A\to B$ by $g(a/s) = g(a)g(s)^{-1}$. To see that this map is well defined, note that if $a/s = a'/s'$, then there is $t\in S$ such that $t(s'a - sa') = 0$, consequently, $g(t)(g(s')g(a) - g(s)g(a')) = 0$. As a result, $g(a)g(s)^{-1} = g(a')g(s')^{-1}$. From this, it follows immediately that $g$ is a ring homomorphism making the diagram commute.

    As for uniqueness, note that for all $a/s\in S^{-1}A$,
    \begin{equation*}
        g(a/s) = g(a/1)g(1/s) = g(a/1)g(s/1)^{-1} = f(a)f(s)^{-1}
    \end{equation*}
    which is fixed by the choice of $f$. This completes the proof.
\end{proof}

\section{Modules of Fractions}

Let $M$ be an $A$-module and $S\subseteq A$ be a multiplicatively closed subset. Define the relation $\sim_S$ on $M\times S$ by $(m,s)\sim_S(m',s')$ if and only if there is $t\in S$ such that $t(s'm - sm') = 0$. That this is an equivalence relation is easy to verify. We shall use $m/s$ to denote the equivalence class $[(m,s)]$ in $M\times S/\sim_S$.

As in the previous section, there is a natural $A$-module homomorphism $\varphi: M\to S^{-1}M$ given by $\varphi(m) = m/1$. This map is called the \textit{localization map}.

It is not hard to see that $S^{-1}M$ forms an $A$-module. Further, it also has the structure of an $S^{-1}A$ module under the action 
\begin{equation*}
    \frac{a}{s}\cdot\frac{m}{t} = \frac{a\cdot m}{st}
\end{equation*}

Let $f: M\to N$ be an $A$-module homomorphism. Consider the map $S^{-1}f: S^{-1}M\to S^{-1}N$ given by 
\begin{equation*}
    S^{-1}f\left(\frac{m}{s}\right) = \frac{f(m)}{s}
\end{equation*}

We must first show that this is well defined. Indeed, if $m/s = m'/s'$, then there is $t\in S$ such that $t(s'm - sm') = 0$, consequently, $t(s'f(m) - sf(m')) = 0$, as a result, $f(m)/s = f(m')/s'$ in $S^{-1}M$. 

We now contend that $S^{-1}f$ is an $S^{-1}A$ module homomorphism. Indeed, we have 
\begin{equation*}
    S^{-1}f\left(\frac{m}{s} + \frac{a}{t}\frac{m'}{s'}\right) = S^{-1}f\left(\frac{ts' m + as m'}{sts'}\right) = \frac{f(ts'm + asm')}{sts'} = \frac{ts'f(m) + asf(m')}{sts'} = \frac{f(m)}{s} + \frac{f(m')}{s'}
\end{equation*}

Finally, let $f: M\to N$ and $g: N\to P$ be $A$-module homomorphisms. Then, 
\begin{equation*}
    S^{-1}(g\circ f)\left(\frac{m}{s}\right) = \frac{g(f(m))}{s}\qquad S^{-1}g\left(S^{-1}f\left(\frac{m}{s}\right)\right) = S^{-1}g\left(\frac{f(m)}{s}\right) = \frac{g(f(m))}{s}
\end{equation*}

\begin{theorem}\thlabel{thm:exactness-of-localization}
    $S^{-1}:A-\catMod\to S^{-1}A-\catMod$ is an exact functor.
\end{theorem}
\begin{proof}
    Let $M'\stackrel{f}{\longrightarrow}M\stackrel{g}{\longrightarrow}M''$ be an exact sequence. Then, for any $m'/s'\in S^{-1}M'$, we have 
    \begin{equation*}
        S^{-1}g\left(S^{-1}f\left(\frac{m'}{s'}\right)\right) = S^{-1}g\left(\frac{f(m')}{s'}\right) = \frac{g(f(m'))}{s'} = 0
    \end{equation*}
    As a result, $\im(S^{-1}f)\subseteq\ker(S^{-1}g)$. On the other hand, for $m/s\in\ker S^{-1}g$, we have $g(m)/s = 0$, consequently, there is $t\in S$ such that $tg(m) = 0$, equivalently, $g(tm) = 0$, whence, there is $m'\in M'$ such that $f(m') = tm$. Then, we have 
    \begin{equation*}
        f\left(\frac{m'}{st}\right) = \frac{f(m')}{st} = \frac{tm}{st} = \frac{m}{s}
    \end{equation*}
    whence, $\ker(S^{-1}g)\subseteq\im(S^{-1}f)$. This completes the proof.
\end{proof}

\begin{proposition}\thlabel{prop:localization-commutes-modules}
    Let $N,P,\{M_i\}_{i\in I}$ be submodules of an $A$-module $M$. Then, for a multiplicatively closed $S\subseteq M$,
    \begin{enumerate}[label=(\alph*)]
        \item $S^{-1}(N\cap P) = S^{-1}N\cap S^{-1}P$
        \item $\displaystyle S^{-1}\left(\sum_{i\in I}M_i\right) = \sum_{i\in I}S^{-1}M_i$
        \item $S^{-1}(M/N)\cong S^{-1}M/S^{-1}N$ as $S^{-1}A$ modules.
    \end{enumerate}
\end{proposition}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
\item We have the exact sequences $0\rightarrow N\cap P\rightarrow N$ and $0\rightarrow N\cap P\rightarrow P$. Due to \thref{thm:exactness-of-localization}, the sequences $0\rightarrow S^{-1}(N\cap P)\rightarrow S^{-1}N$ and $0\rightarrow S^{-1}(N\cap P)\rightarrow S^{-1}N$ are exact, consequently, $S^{-1}(N\cap P)\subseteq S^{-1}N\cap S^{-1}P$.

On the other hand, if $n/s = p/t$ for some $n\in N$, $p\in P$ and $s,t\in S$, there is some $u\in S$ such that $u(tn - sp) = 0$, equivalently, $m = utn = usp\in N\cap P$. Thus, $m/(stu) = n/s = p/t$, and the conclusion follows.

\item Let $\overline M = \sum_{i\in I}M_i$. Then, there is the exact sequence $0\rightarrow M_i\rightarrow \overline M$. Then, due to \thref{thm:exactness-of-localization}, the sequence $0\rightarrow S^{-1}M_i\rightarrow S^{-1}\overline M$ is exact. Consequently, $\displaystyle\sum_{i\in I}S^{-1}M_i\subseteq S^{-1}\overline M$.

On the other hand, any element in $S^{-1}\overline M$ is of the form $(m_{i_1} + \cdots + m_{i_n})/s = m_{i_1}/s + \cdots + m_{i_n}/s$ for some $m_{i_n}\in M_{i_n}$ and $s\in S$. The conclusion follows.

\item Consider the short exact sequence $0\rightarrow N\rightarrow M\rightarrow M/N\rightarrow 0$. Due to \thref{thm:exactness-of-localization}, we obtain the short exact sequence of $S^{-1}A$-modules $0\rightarrow S^{-1}N\rightarrow S^{-1}M\rightarrow S^{-1}(M/N)\rightarrow 0$ whereby the conclusion follows.
\end{enumerate}
\end{proof}

\begin{proposition}
    Let $S\subseteq A$ be a multiplicative subset. Then, there is a natural isomorphism $S^{-1}M\cong S^{-1}A\otimes_A M$.
\end{proposition}
\begin{proof}
    Consider the map $T: S^{-1}A\times M\to S^{-1}M$, given by $T(a/s, m) = am/s$. This is a bilinear map whereby it induces a map $f: S^{-1}A\otimes_A M\to S{-1}M$ given by $f(a/s\otimes m) = am/s$. This is surjective, since $f(1/s\otimes m) = m/s$. We shall show $\ker f = 0$. Indeed, suppose the finite sum $\sum_i a_i/s_i\otimes m_i$ is in $\ker f$. Let $s = \prod_i s_i$ and $t_i = \prod_{j\ne i}s_i$. Then, 
    \begin{equation*}
        \sum_{i}a_i/s_i\otimes m_i = 1/s\otimes\left(\sum_i a_it_im_i\right)
    \end{equation*}
    The image under $f$ of this tensor is $(\sum_i a_it_im_i)/s$ which is zero, whence there is $u\in S$ such that $u\sum_i a_it_im_i = 0$, but this implies 
    \begin{equation*}
        1/s\otimes\left(\sum_i a_it_im_i\right) = 1/su\otimes\left(u\sum_i a_it_im_i\right) = 0
    \end{equation*}
    This completes the proof.
\end{proof}
\begin{corollary}
    For every multiplicative subset $S\subseteq A$, $S^{-1}A$ is a flat $A$-module.
\end{corollary}
\begin{corollary}
    Let $\{M_i\}_{i\in I}$ be a collection of $A$-modules. If $S\subseteq A$ is a multiplicative subset, then 
    \begin{equation*}
        S^{-1}\left(\bigoplus_{i\in I} M_i\right)\cong\bigoplus_{i\in I} S^{-1}M_i
    \end{equation*}
    as $S^{-1}A$-modules. As a result, 
    \begin{equation*}
        S^{-1}\left(\sum_{i\in I} M_i\right)\cong\sum_{i\in I} S^{-1}M_i
    \end{equation*}
    as $S^{-1}A$-modules.
\end{corollary}
\begin{proof}
    The first assertion follows from the fact that the tensor product commutes with direct sums. As for the second assertion, consider the exact sequence 
    \begin{equation*}
        \bigoplus_{i\in I} M_i\longrightarrow\sum_{i\in I} M_i\longrightarrow 0
    \end{equation*}
    and localize.
\end{proof}

\begin{proposition}
    Let $S\subseteq A$ be a multiplicative subset. Then, there is a natural isomorphism $S^{-1}(M\otimes_A N) = S^{-1}M\otimes_{S^{-1}A}S^{-1}N$.
\end{proposition}
\begin{proof}
    Define the map 
    \begin{equation*}
        \Phi: S^{-1}M\times S^{-1}N\to S^{-1}(M\otimes_A N) 
    \end{equation*}
    given by 
    \begin{equation*}
        \Phi\left(\frac{m}{s}, \frac{n}{t}\right) = \frac{m\otimes n}{st}.
    \end{equation*}
    This is obviously $S^{-1}A$-linear and thus induces a map 
    \begin{equation*}
        \Psi: S^{-1}M\otimes_{S^{-1}A} S^{-1}N\to S^{-1}(M\otimes_A N) 
    \end{equation*}
    given by 
    \begin{equation*}
        \Psi\left(\frac{m}{s}\otimes\frac{n}{t}\right) = \frac{m\otimes n}{st}.
    \end{equation*}
    We contend that this is an isomorphism of vector spaces. Define the map 
    \begin{equation*}
        \Gamma: S^{-1}(M\otimes_A N)\to S^{-1}M\otimes_{S^{-1}A} S^{-1}N
    \end{equation*}
    by 
    \begin{equation*}
        \Gamma\left(\frac{m\otimes n}{s}\right) = \frac{m}{s}\otimes\frac{n}{1}.
    \end{equation*}
    It is not hard to see that $\Gamma\circ\Psi$ and $\Psi\circ\Gamma$ are the identity maps whence they are isomorphisms.
\end{proof}

\section{Local Properties}

A property $P$ defined on the class of modules is said to be local if for every $A$-module $M$,
\begin{quotation}
    $M$ satisfies $P$ if and only if $M_\frakp$ satisfies $P$ for each $\frakp\in\spec A$.
\end{quotation}

\begin{proposition}
    Let $M$ be an $A$-module. Then, the following are equivalent: 
    \begin{enumerate}[label=(\alph*)]
        \item $M = 0$ 
        \item $M_\frakp = 0$ for each $\frakp\in\spec A$
        \item $M_\frakm = 0$ for each $\frakm\in\mspec A$
    \end{enumerate}
\end{proposition}
\begin{proof}
    That $(a)\Longrightarrow(b)\Longrightarrow(c)$ is obvious. We shall show $(c)\Longrightarrow(a)$. Suppose not, then there is $x\in M\backslash\{0\}$. Since $\Ann_A(x)$ is a proper ideal in $A$, it is contained in some maximal ideal, say $\frakm$. Since $M_\frakm = 0$, there is $s\in A\backslash\frakm$ such that $sx = 0$, a contradiction. This completes the proof.
\end{proof}

\begin{proposition}\thlabel{prop:inj-surj-local}
    Let $\phi: M\to N$ be an $A$-module homomorphism. Then, the following are equivalent: 
    \begin{enumerate}[label=(\alph*)]
        \item $\phi$ is injective (surjective).
        \item $\phi_\frakp: M_\frakp\to N_\frakp$ is injective (surjective).
        \item $\phi_\frakm: M_\frakm\to N_\frakm$ is injective (surjective).
    \end{enumerate}
\end{proposition}
\begin{proof}
    $(a)\implies(b)$ follows from the exactness of localization applied to the exact sequence $0\rightarrow M\rightarrow N$ ($M\rightarrow N\rightarrow 0$) and $(b)\implies (c)$ is trivial. We shall show $(c)\implies(a)$. We have the exact sequence $0\rightarrow \ker \phi\rightarrow M\rightarrow N\rightarrow\coker \phi\rightarrow 0$. Upon localizing, for all maximal ideals $\frakm$, we have the exact sequence 
    \begin{equation*}
        0\longrightarrow(\ker\phi)_\frakm\longrightarrow M_\frakm\longrightarrow N_\frakm\longrightarrow(\coker\phi)_\frakm\longrightarrow 0
    \end{equation*}
    Since we have $\phi_\frakm$ is injective (surjective), we have $(\ker\phi)_\frakm$ ($(\coker\phi)_\frakm$) is zero for all maximal ideals $\frakm$, whence we are done using  to the previous proposition.
\end{proof}

\begin{proposition}
    Flatness is a local property. That is, the following are equivalent.
    \begin{enumerate}[label=(\alph*)]
        \item $M$ is a flat $A$-module. 
        \item $M_\frakp$ is a flat $A_\frakp$-module for every $\frakp\in\spec(A)$. 
        \item $M_\frakm$ is a flat $A_\frakm$-module for every $\frakm\in\mspec(A)$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    $(a)\implies(b)$ follows from the exactness of localization and $(b)\implies(c)$ is obvious. We shall show $(c)\implies(a)$.\todo{show that c=>a}
\end{proof}

\begin{proposition}\thlabel{prop:fp-projective-locally-free}
    Let $M$ be a finitely presented $A$-module. Then, the following are equivalent: 
    \begin{enumerate}[label=(\alph*)]
        \item $M$ is projective
        \item $M_\frakp$ is projective for all $\frakp\in\spec A$ 
        \item $M_\frakm$ is projective for all $\frakp\in\mspec A$ 
    \end{enumerate}
\end{proposition}
\begin{proof}
    $(a)\implies(b)$. If $M$ is projective, there is a positive integer $n$ and an $A$-module $N$ such that $M\oplus N\cong A^n$. As a result, $M_\frakp\oplus M_\frakp\cong A_\frakp^{\oplus n}$ and is projective. 

    $(c)\implies(a)$. 
\end{proof}

A surprising consequence of the previous proposition is the following. 
\begin{proposition}
    A finitely presented flat $A$-module is projective.
\end{proposition}
\begin{proof}
    Follows from \thref{prop:fp-projective-locally-free} and \thref{prop:fp-flat-local-free}.
\end{proof}

\begin{proposition}
    ``Being an integral domain'' is \underline{not} a local property. Similarly, ``being noetherian'' is \underline{not} a local property.
\end{proposition}
\begin{proof}
    Let $A$ be a nonzero integral domain and consider the ring $R = A\times A$. This is not an integral domain. Due to \thref{prop:localization-of-product}, every localization of $R$ is isomorphic to $A_{\frakp}$ for some $\frakp\in\spec A$, consequently, is an integral domain. 

    As for the second assertion, consider the ring $R = k\times k\times\cdots$ where $k$ is a nonzero field. This is obviously not noetherian due to the following ascending chain of ideals: 
    \begin{equation*}
        (0)\times(0)\times\cdots\subsetneq k\times(0)\times\cdots\subsetneq\cdots
    \end{equation*}
    But due to \thref{prop:localization-of-product}, every localization is isomorphic to $k$, consequently, is noetherian.
\end{proof}

\section{Extension and Contraction of Ideals}

\begin{definition}
    If $\fraka\subseteq A$ is an ideal, $S\subseteq A$ a multiplicatively closed subset and $\varphi: A\to S^{-1}A$ the natural map. Define $S^{-1}\fraka$ to be the extension of $\fraka$ under the natural map $\varphi$.
\end{definition}

\begin{theorem}
    Let $S\subseteq A$ be a multiplicatively closed set. Then, 
    \begin{enumerate}[label=(\alph*)]
        \item Every ideal in $S^{-1}A$ is an extended ideal. 
        \item If $\fraka\subseteq A$ is an ideal, then 
        \begin{equation*}
            \fraka^{ec} = \bigcup_{s\in S}(\fraka: s)
        \end{equation*}
        Hence, $\fraka^e = (1)$ if and only if $\fraka\cap S\ne\emptyset$ 
        \item There is a bijection 
        \begin{equation*}
            \{\frakp\in\spec A\mid S\cap\frakp = \emptyset\}\leftrightarrow\spec(S^{-1}A)
        \end{equation*}
        given by $\frakp\mapsto S^{-1}\frakp$, which is just the extension map.
    \end{enumerate}
\end{theorem}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
    \item Let $\fraka\subseteq S^{-1}A$ be an ideal. We shall show that $\fraka^{ce} = \fraka$. We know that $\fraka^{ce}\subseteq\fraka$ therefore, it suffices to show the reverse inclusion. Let $x/s\in\fraka$. Then, $x/1\in\fraka$, and $x\in\fraka^c$. As a result, $x/1\in\fraka^{ce}$ and $x/s\in\fraka^{ce}$, implying the desired conclusion.
    \item 
    \item Let $\frakp$ be a prime ideal in $A$ that does not meet $S$. Let $a/s,b/t\in S^{-1}A$ such that $ab/st\in S^{-1}\frakp$, whereby there is an element $p\in\frakp$ and $r\in S$ such that $ab/st = p/r$ whence there is $u\in S$ such that $uabr = ustp$. Since $ur\notin\frakp$, we must have $ab\in\frakp$, consequently, either $a/s\in S^{-1}\frakp$ or $b/t\in S^{-1}\frakp$, implying the desired conclusion.

    Conversely, since the contraction of any prime ideal in $S^{-1}\frakp$ is also a prime ideal not meeting $S$, lest the prime ideal in $S^{-1} A$ contain a unit. Now, if $\frakp$ is a prime ideal, then 
    \begin{equation*}
        \frakp\subseteq\frakp^{ec} = \bigcup_{s\in S}(\frakp: s)\subseteq\frakp
    \end{equation*}
    On the other hand, from $(a)$, we see that if $\frakq$ is a prime ideal in $S^{-1}A$, then $\frakq^{ce} = \frakq$, whereby the bijection is established.
\end{enumerate}
\end{proof}

\begin{proposition}
    The operation $S^{-1}$ on ideals of $A$ commutes with formation of finite sums, products, intersections and radicals.
\end{proposition}

\begin{corollary}
    $S^{-1}(\frakN(A)) = \frakN(S^{-1}A)$
\end{corollary}
\begin{proof}
    Since $\frakN(A) = \sqrt{(0)}$.
\end{proof}

From the above proposition, we see that ``$\frakN(A) = (0)$'' is a local property.

\begin{proposition}
    If $M$ is finitely generated, then $S^{-1}\Ann_A(M) = \Ann_A(S^{-1}M)$. 
\end{proposition}
\begin{proof}
    Induction on the number of generators. Sort of straightforward. Use the fact that 
    \begin{equation*}
        \Ann(N_1 + N_2) = \Ann(N_1)\cap\Ann(N_2)\qedhere
    \end{equation*}
\end{proof}

\begin{theorem}\thlabel{thm:prime-is-contraction}
    Let $f: A\to B$ be ring homomorphism. Then, $\frakp\in\spec(A)$ is a contraction of a prime ideal in $B$ if and only if $\frakp^{ec} = \frakp$.
\end{theorem}
\begin{proof}
    We shall prove only the converse, since the other direction is trivial. Suppose $\frakp^{ec} = \frakp$. Let $S = f(A\backslash\frakp)$, which is obviously a multiplicatively closed subset of $B$. Obviously, $\frakp^e\cap S = \emptyset$ whence $S^{-1}\frakp^e$ is a proper ideal in $S^{-1}B$. Let $\frakm\subseteq S^{-1}B$ be a maximal ideal containing $S^{-1}\frakp^e$. Let $\frakq$ be the contraction of $\frakm$ in $B$. This is a prime ideal containing $\frakp^e$ and $\frakq\cap S = \emptyset$, whence, $\frakq^c$ must be contained in $\frakp$ but it also contains $\frakp$ therefore, is equal to $\frakp$. This completes the proof.
\end{proof}

\hrulefill 

\begin{theorem}
    $A$ is absolutely flat if and only if $A_\frakm$ is a field for every $m\in\mspec(A)$.
\end{theorem}
\begin{proof}
    The forward direction is obvious. We shall show the converse. Let $M$ be an $A$-module. Then, $M_\frakm$ is an $A_\frakm$-vector space and thus a flat $A_\frakm$-module. Since flatness is a local property, we see that $M$ must be a flat $A$-module.
\end{proof}

\section{Support of a Module}

\begin{definition}
    For an $A$-module $M$, the support of a module $\Supp(M)$ is defined to be the set of all prime ideals $\frakp\in\spec(A)$ such that $M_\frakp\ne 0$.
\end{definition}

\begin{theorem}
    For an $A$-module $M$ and an ideal $\fraka\unlhd A$, the following are true. 
    \begin{enumerate}[label=(\alph*)]
        \item If $M\ne 0$, then $\Supp(M)\ne\emptyset$. 
        \item $\Supp(A/\fraka) = V(\fraka)$.
        \item If $0\to M'\to M\to M''\to 0$ is a short exact sequence, then $\Supp(M) = \Supp(M')\cup\Supp(M'')$. 
        \item If $M = \sum_{i\in I} M_i$, then $\Supp(M) = \bigcup_{i\in I}\Supp(M_i)$. 
        \item If $M$ is finitely generated, then $\Supp(M) = V(\Ann_A(M))$. 
        \item If $M$ and $N$ are finitely generated, then $\Supp(M\otimes_A N) = \Supp(M)\cap\Supp(N)$. 
        \item If $M$ is finitely generated, then $\Supp(M/\fraka M) = V(\fraka + \Ann_A(M))$.
    \end{enumerate}
\end{theorem}
\begin{proof}
\begin{enumerate}[label=(\alph*)]
    \item Follows from the fact that being zero is a local property. 
    \item Note that $(A/\fraka)_\frakp = A_\frakp/\fraka_\frakp$ and $\fraka_\frakp\subsetneq A_\frakp$ if and only if $\fraka\subseteq\frakp$.
    \item Consider the localized short exact sequence 
    \begin{equation*}
        0\longrightarrow M'_\frakp\longrightarrow M_\frakp\longrightarrow M''_\frakp\longrightarrow 0.
    \end{equation*}
    If $\frakp\in\Supp(M)$, then it must lie in either $\Supp(M')$ or $\Supp(M'')$. On the other hand, if $\frakp\notin\Supp(M)$, then the above sequence is 
    \begin{equation*}
        0\longrightarrow M'_\frakp\longrightarrow 0\longrightarrow M''_\frakp\longrightarrow 0
    \end{equation*}
    whence $\frakp\notin\Supp(M')\cup\Supp(M'')$. 
    \item Follows from the fact that localization commutes with arbitrary sums.
    \item First suppose $M = (x_1)$. Then, $\frakp\in\Supp(M)$ if and only if $\Ann_A(x_1)\subseteq\frakp$. Thus the assertion holds for cyclic modules. Then, using the previous assertion,
    \begin{equation*}
        \Supp((x_1,\dots,x_n)) = \bigcup_{i = 1}^n V(\Ann_A(x_i)) = V\left(\bigcap_{i = 1}^n\Ann_A(x_i)\right) = V(\Ann_A(M)).
    \end{equation*}
    \item Suppose $\frakp\notin\Supp(M\otimes_A N)$, then $M_\frakp\otimes_{A_\frakp}N_\frakp = 0$ and $M_\frakp, N_\frakp$ are finitely generated $A_\frakp$-modules. Due to \thref{prop:tensor-over-local-zero}, $M_\frakp = 0$ or $N_\frakp = 0$, whence $\frakp\notin\Supp(M)\cap\Supp(N)$, that is, $\Supp(M)\cap\Supp(N)\subseteq\Supp(M\otimes_A N)$. On the other hand, if $\frakp\notin\Supp(M)\cap\Supp(N)$, then $M_\frakp\otimes_{A_\frakp} N_\frakp = 0$ and the conclusion follows.

    \item We have, due to the previous assertion, 
    \begin{equation*}
        \Supp(A/\fraka\otimes_A M) = \Supp(A/\fraka)\cap\Supp(M) = V(\fraka)\cap V(\Ann_A(M)) = V(\fraka + \Ann_A(M)).\qedhere
    \end{equation*}
\end{enumerate}
\end{proof}

\subsection*{Place This Somewhere}

\begin{lemma}
    Let $M$ be a finitely generated $A$-module. Let $\fraka\unlhd A$ be an ideal and $x_1,\dots,x_n\in M$ generate $M/\fraka M$. Then, there is $f\in 1 + \fraka$ such that $x_1/1,\dots,x_n/1$ generate $M_f$ as an $A_f$-module.
\end{lemma}
\begin{proof}
    Consider the map $\phi: A^n\to M$ mapping $e_i$ to $x_i$. Note that $\coker \phi\otimes_A A/\fraka = 0$ and thus, due to \thref{corr:stronger-nakayama}, there is some $f\in 1 + \fraka$ such that $f\coker\phi = 0$. The conclusion now follows.
\end{proof}

\begin{lemma}
    Let $M$ be a finitely generated $A$-module. Then, the following are equivalent:
    \begin{enumerate}[label=(\alph*)]
        \item $M$ is projective. 
        \item $M$ is strongly locally free. 
        \item For every $\frakp\in\spec(A)$, the module $M_\frakp$ is free and has locally constant dimension with respect to the Zariski topology.
    \end{enumerate}
\end{lemma}
\begin{proof}
$(a)\implies(b)$.

$(b)\implies(a)$. \todo{simplify this}

$(b)\implies(c)$ Trivial.

$(c)\implies(b)$ Let $\frakm\subseteq A$ be a maximal ideal and let $x_1,\dots,x_r\in M$ map to an $A/\frakm$-basis of $M/\frakm M$. Then, due to the previous lemma, there is some $f\in 1 + \frakm$ such that $x_1/1,\dots,x_r/1$ generate $M_f$ over $A_f$.

Since $\rho_M$ is locally constant, it is equal to $r$ on an open set containing $\frakm\in\spec(A)$. Choose a basic open set $D(g)$ with $g\notin\frakm$ on which $\rho_M$ is constant and equal to $r$. Define the map $\Psi: A_{fg}^r\to M_{fg}$ given by 
\begin{equation*}
    \Phi\left(a_1,\dots, a_r\right) = \sum_{i = 1}^r a_i\frac{x_i}{1}.
\end{equation*}
We contend that this is an isomorphism. Note the primes in $A_{fg}$ are precisely the extensions of the primes in $D(fg)$. Let $\frakp\in D_{fg}$. Then, the localization $\Psi_{\frakp}$, at the extension of $\frakp$ in $A_{fg}$ is the map 
\begin{equation*}
    \Psi_{\frakp}: A_{\frakp}^r\to M_\frakp\qquad\Psi\left(a_1,\dots,a_r\right) = \sum_{i = 1}^r a_i\frac{x_i}{1}.
\end{equation*}
Note that $\frakp\in D(fg)\subseteq D(f)$ and thus, $\Psi_\frakp$ is surjective since $x_1/1,\dots,x_r/1$ generate $M_f$ over $A_f$. Further, since $M_\frakp$ is finitely generated and isomorphic to $A_\frakp^r$, the surjection $\Psi_\frakp$ must be an isomorphism whence $\Psi$ is an isomorphism. 

Hence, for each maximal $\frakm$, we have found some $h\notin\frakm$ such that $M_h$ is a free $A_h$-module. The set of all such $h$'s must generate $(1)$ else they would be contained in a maximal ideal. This proves (b).
\end{proof}